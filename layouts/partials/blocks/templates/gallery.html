<section class="block-gallery">
  {{ if .title }}
    <h2 id="block-{{ .position }}">{{ partial "PrepareHTML" .title }}</h2>
  {{ end }}
  <div class="gallery">
    {{ range .data.images }}
      <figure>
        {{ if .file }}
          {{- $image := partial "GetMedia" .file -}}
          {{- $url := $image.url -}}
          {{- if site.Params.keycdn -}}
            {{- $url = $image.direct_url -}}
          {{- end -}}
          {{- $default := "1280x2560" -}}
          <a class="glightbox"
            data-glightbox="type: image;{{ if .text }} title:{{ partial "GetTextFromHTML" .alt }}; description:{{ partial "GetTextFromHTML" .text }};{{ end }}"
            href="{{ partial "GetImageUrl" (dict "url" $url "size" $default ) }}">
            {{ partial "commons/image.html"
                (dict
                  "image"    .file
                  "alt"      .alt
                  "mobile"   "164x164"
                  "tablet"   "336x336"
                  "desktop"  "306x306"
                )}}
          </a>
        {{ end }}
        <figcaption>{{ trim (partial "PrepareHTML" .alt) "\n " -}}</figcaption>
      </figure>
    {{ end }}
  </div>

</section>
