{{ $position := .position }}
{{ $term := false }}
{{ with .data }}
  {{ if .category }}
    {{ $term = site.GetPage (printf "/categories%s" .category) }}
  {{ end }}
{{ end }}

<section class="block-posts" id="block-{{ $position }}">
  {{ if .title }}
    <div class="top">
      <h2>
        {{ if $term }}
          <a href="{{ $term.Permalink }}">
        {{ end }}
          {{- partial "PrepareHTML" .title -}}
        {{ if $term }}
          </a>
        {{ end }}
      </h2>
    </div>
  {{ end }}

  {{ with .data }}
    <div class="posts">
      {{ $posts := where site.RegularPages "Type" "posts" }}
      {{ range .posts }}
        {{ range where $posts "Params.slug" . }}
          <div>
            {{ partial "posts/post" . }}
          </div>
        {{ end }}
      {{ end }}
    </div>
  {{ end }}
</section>
